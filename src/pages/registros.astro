---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

// Obtener todas las entradas de la colección 'registros'.
// ¡Ahora aprovecha el `config.ts` que creamos!
const allEntries = await getCollection("registros");

// Ordenar las entradas por fecha, de más nueva a más antigua.
const sortedEntries = allEntries.sort(
  (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
);

// Función para formatear la fecha (el objeto Date ya viene procesado).
function formatDate(date: Date) {
  return date.toLocaleDateString("es-ES", {
    day: "numeric",
    month: "long",
    year: "numeric",
  });
}
---

<BaseLayout title="Registros de la campaña">
  <main class="max-w-4xl mx-auto px-6 py-16">
    <h1 class="text-4xl font-bold text-primary font-serif mb-10 text-center">
      Registros de la campaña
    </h1>

    <div class="space-y-8">
      {sortedEntries.map((entry) => (
        <article class="bg-surface border border-secondary/30 rounded p-6 shadow">
          <h2 class="text-2xl font-bold text-primary mb-2 hover:underline">
            <a href={`/registros/${entry.slug}`} class="hover:cursor-pointer">
              {entry.data.title}
            </a>
          </h2>
          <p class="text-sm text-secondary mb-4">
            {formatDate(entry.data.date)}
          </p>
          <p class="text-secondary">{entry.data.resumen}</p>
        </article>
      ))}
    </div>
  </main>
</BaseLayout>
